<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Josh Long">
<title>Everything You Never Wanted to Know About Spring Boot 3 AOT</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article">
<div id="header">
<h1>Everything You Never Wanted to Know About Spring Boot 3 AOT</h1>
<div class="details">
<span id="author" class="author">Josh Long</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hi, Spring fans! Spring Boot 3 is here, and it&#8217;s amazing! If you want to know the broad strokes of Spring Framework 6 includes, check <a href="https://www.youtube.com/watch?v=aUm5WZjh8RA">out this Spring Tips video</a> for a quick rundown. In this text, however, I want to look at the details of the brand-new ahead-of-time (AOT) compilation engine in Spring Boot 3.</p>
</div>
<div class="paragraph">
<p>Spring Boot 3&#8217;s AOT engine introduces a new component model designed to provide extra information about a Spring application to support optimizing the application both on the JRE and in a GraalVM native image context. For the 80% case, you shouldn&#8217;t worry about a thing. But, sometimes, you may need to intervene to get the best results. This text aims to introduce the engine, its happy-path usage, and the corner-case use.</p>
</div>
<div class="paragraph">
<p>Why would you need to intervene? What could go wrong? GraalVM native image compilation, that&#8217;s what. GraalVM&#8217;s native image compilation produces lightning-quick and super memory-efficient binaries. The caveat is that to achieve this magic trick, GraalVM&#8217;s native image compiler needs to know when you do certain things, like reflection, proxies, JNI, serialization, etc. So somebody has to provide that configuration.</p>
</div>
<div class="paragraph">
<p>The GraalVM native image compiler needs this configuration specified either as command line switches or as <code>.json</code> configuration files present on the classpath - <code>META-INF/native-image/{reflect,jni,resource,proxy,etc.}-config.json</code>. Ideally, each library will ship its configuration. For example, Apache Tomcat, Netty, etc., need to support their use by furnishing this configuration. But what about your code, written with Spring Framework? Spring (and Java, writ large) do many dynamic things with user-provided types that they need to account for with configuration, or the GraalVM compilation will fail.</p>
</div>
<div class="paragraph">
<p>In this release, we&#8217;ve introduced a whole new engine - the Spring AOT engine - to make it possible to take your existing Spring Boot applications, upgrade them to Spring Boot 3, and then enjoy the incredible benefits of GraalVM native image compilation. That&#8217;s the dream, anyway, and we&#8217;re essentially there already. This text will look at the new AOT engine, GraalVM, and the increasingly rarer corner cases requiring some intervention.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I find it helpful to understand where we were to appreciate where we are now. Traditional Spring applications have <em>phases</em> that they go through when they run. Here&#8217;s a simplified understanding of what&#8217;s happening in your standard Spring application:</p>
</div>
<div class="sect2">
<h3 id="_ingest">Ingest</h3>
<div class="paragraph">
<p>The Spring application starts up and reads in all the configuration sources. Remember: Spring Framework is a dependency management framework. It needs to know how your various objects are constructed, their lifecycles (constructors, <code>InitializingBean#afterPropertiesSet</code>,<code>@PostConstruct</code>, <code>DisposableBean#destroy</code>, <code>@PreDestroy</code>), etc. So it reads the various configuration files from all the <code>@Configuration</code>-annotated classes in your application through component scanning, where Spring discovers classes annotated with <code>@Component</code>. This component scanning also discovers classes annotated with annotations that have the <code>@Component</code> annotation on them, like <code>@Service</code>, <code>@Repository</code>, @Controller`, and <code>@RestController</code>. It also reads in configuration from Spring&#8217;s classic XML configuration format. (I don&#8217;t use the XML format and haven&#8217;t seen it in the wild in over half a decade, but <em>still</em>&#8230;&#8203;).</p>
</div>
</div>
<div class="sect2">
<h3 id="_beanfactory_creation_of_beandefinition_instances"><code>BeanFactory</code> creation of <code>BeanDefinition</code>  instances</h3>
<div class="paragraph">
<p>At this point, Spring turns all the various inputs into a metamodel representation of your objects, a <code>BeanFactory</code> full of <code>BeanDefinition</code> instances. These <code>BeanDefinition</code> instances describe the objects, wiring, and more. They represent the constructors, annotations, properties to be injected, setters, etc.  The <code>BeanDefinition</code> instances describe everything required to describe an object and get to a valid state so that it may be given to other objects and generally start doing work.</p>
</div>
<div class="paragraph">
<p>Notably, at this phase, there are no live-fire beans. Nothing is opening ports and sockets, doing disk IO, etc. This phase in the <code>BeanFactory</code> does not involve any business logic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bean_creation">Bean Creation</h3>
<div class="paragraph">
<p>Spring will take all the <code>BeanDefinition</code> instances and create actual, live-fire beans. Spring will call constructors, invoke lifecycle methods, etc. After this phase, you&#8217;ll have an application ready to serve production traffic. Being production-worthy is <em>good</em> &#8482;. We like production, don&#8217;t we?</p>
</div>
<div class="paragraph">
<p>Spring Boot 3 introduces a new phase, at compile time, to support AOT.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/bean-evolution.png" alt="bean evolution">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enter_graalvm">Enter GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.graalvm.org/">GraalVM</a> is a drop-in replacement for OpenJDK. It <em>is</em> OpenJDK, largely. It has a few extra utilities: notably, a polyglot VM, a native image compiler, and a replacement  HotSpot replacement for the JIT (just-in-time) compiler. We could spend all day on these extra features, but let&#8217;s focus on the <code>native-image</code> compiler. Henceforth, when I say "GraalVM," I refer to the <code>native-image</code> compiler.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_you_gotta_start_somewhere">You Gotta Start Somewhere</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start, as always, we&#8217;ll go to the <a href="https://start.spring.io">Spring Initialzr (start.spring.io)</a>. Choose Spring Boot 3.0 or later from the Spring Initializr. I&#8217;m using Spring Boot 3, Apache Maven, and Java 17. Java 17 is the new baseline for Spring Framework 6 and Spring Boot 3. I&#8217;m also using GraalVM 22.3. If you&#8217;re using the fabulous <a href="https://sdkman.io/">SDKMAN utility</a>, then you can do the following to get the same version of GraalVM that I have on my computer as of this writing (late 2022):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sdk install java 22.3.r17-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;ve also added a few dependencies. We won&#8217;t touch on these dependencies in any great length, but they&#8217;ll help us to demonstrate a few concepts, so I&#8217;ve added them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web (<code>org.springframework.boot</code> : <code>spring-boot-starter-web</code>)</p>
</li>
<li>
<p>Actuator (<code>org.springframework.boot</code> : <code>spring-boot-starter-actuator</code>)</p>
</li>
<li>
<p>Spring Data JDBC (<code>org.springframework.boot</code> : <code>spring-boot-starter-data-jdbc</code>)</p>
</li>
<li>
<p>H2 (<code>com.h2database</code> : <code>h2</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And, of course, I&#8217;ve got a standard Spring Boot entry class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class AotApplication {

	public static void main(String[] args) {
		SpringApplication.run(AotApplication.class, args);
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>I won&#8217;t add anything to this class. Instead, as we introduce new concepts, I&#8217;ll create new <code>@Configuration</code>-annotated classes in sub-packages. We won&#8217;t revisit this class.</p>
</div>
<div class="paragraph">
<p>In practice, let&#8217;s look at our first example of the new AOT engine. This trivial and fairly typical application works with a database and surfaces an HTTP endpoint like any other trivial Spring Boot application. But, of course, you have seen this before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.basics;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.annotation.Id;
import org.springframework.data.repository.CrudRepository;

import java.util.stream.Stream;

@Configuration
class BasicsConfiguration {

	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; basicsApplicationListener(CustomerRepository repository) {
		return event -&gt; repository //
				.saveAll(Stream.of("A", "B", "C").map(name -&gt; new Customer(null, name)).toList()) //
				.forEach(System.out::println);
	}

}

// <b class="conum">(1)</b>
record Customer(@Id Integer id, String name) {
}

// <b class="conum">(2)</b>
interface CustomerRepository extends CrudRepository&lt;Customer, Integer&gt; {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>look ma, no Lombok!</p>
</li>
<li>
<p>this is using Spring Data JDBC, and you can too!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You&#8217;ll need some SQL schema, so add <code>src/main/resources/schema.sql</code> for our SQL interactions; so let&#8217;s have Spring Boot create it for us on startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">create table customer
(
    id   serial primary key,
    name varchar(255) not null
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the main class in your IDE or on the command line in the usual ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">mvn -DskipTests spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see some output on the console. It works. Hurray. Moving on, let&#8217;s turn it into a native image, thusly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn -Pnative -DskipTests native:compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;ll take a minute to finish, so now&#8217;s a good time to pour a cup of coffee or tea. Maybe do a crossword puzzle. Reflect on your poor life choices to get to this point where your JVM applications take around a minute to compile. It&#8217;s a bit dispiriting. But always remember: good things come to those who wait!</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find the compiled binary in the <code>target</code> directory, named <code>aot</code>. Run it, and you&#8217;ll see it starts up in no time at all. Like a lightbulb! And, the best part is that it takes very little memory. Of course, there are different ways to measure memory, but looking at <a href="https://en.wikipedia.org/wiki/Resident_set_size"><em>resident set size</em></a> is informative. Here&#8217;s a script I use to measure this stuff called <code>rss.sh</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">#!/usr/bin/env bash
PID=${1}
RSS=`ps -o rss ${PID} | tail -n1`
RSS=`bc &lt;&lt;&lt; "scale=1; ${RSS}/1024"`
echo "${PID}: ${RSS}M"</code></pre>
</div>
</div>
<div class="paragraph">
<p>It captures the RSS for a given process identifier, scales it to make it easier to parse, then prints it out. So, for example, you can find the process identifier (PID) for the Spring Boot application in the console towards the top of the application&#8217;s output.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/pid.png" alt="pid">
</div>
</div>
<div class="paragraph">
<p>Take it and then pass it as the argument for <code>rss.sh</code>, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./rss.sh &lt;PID&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On my 2021 M1 MacBook Pro, I tend to get numbers just south of 100MB. Not bad!   How much RAM is your current JVM application taking? I&#8217;d be pleasantly surprised if it were a gigabyte or less! Imagine being able to deploy the same application for 1/10th of the memory footprint!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_spring_component_model">The Spring component model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So, we know the basic stuff&#8217;s working. Spring&#8217;s got a rich, dynamic, multifaceted component model that can do amazing things. So, let&#8217;s look at some examples demonstrating a few interesting aspects of the Spring programming model, old and new(-ish). I hope, but don&#8217;t know, that a lot of this will rehash old stuff for many of you. So, feel free to skim this section and see if anything new in the headers strikes you as interesting. It&#8217;s here because I wanted to be thorough and view the rich Spring component model through the prism of the new Spring AOT engine.</p>
</div>
<div class="sect2">
<h3 id="_see_how_they_run">See How They Run</h3>
<div class="paragraph">
<p>You can compile and run all the code in the usual way as a GraalVM native image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn -DskipTests native:compile &amp;&amp; ./target/aot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the application, and you should see all the output from the previous examples, as expected. The best part? It&#8217;ll have started in no time and be far smaller than a binary and a process occupying RAM. You can use the <code>rss.sh</code> script we introduced to measure the process' RSS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_listeners">Event Listeners</h3>
<div class="paragraph">
<p>Did you know that Spring has an event bus that you can use to publish and receive events in one component or another? Any component can fire an event (or more) and listen to and consume these events. There are two ways to consume events: with a bean of type <code>ApplicationListener&lt;ApplicationEvent&gt;</code>, or with the <code>@EventListener</code> annotation.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.events;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.boot.web.context.WebServerInitializedEvent;
import org.springframework.context.ApplicationEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.event.EventListener;

@Configuration
class EventsConfiguration {

	// <b class="conum">(1)</b>
	@Bean
	ApplicationListener&lt;WebServerInitializedEvent&gt; webServerInitializedEventApplicationListener() {
		return event -&gt; run("ApplicationListener&lt;WebServerInitializedEvent&gt;", event);
	}

	// <b class="conum">(2)</b>
	@EventListener
	public void eventListener(ApplicationReadyEvent event) {
		run("@EventListener", event);
	}

	private void run(String where, ApplicationEvent are) {
		System.out.println(where + " : " + are);
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this is the first more traditional approach: a bean of type <code>ApplicationListener&lt;T extends ApplicationEvent&gt;</code>.</p>
</li>
<li>
<p>this is the newer style, which frees your code of any explicit dependencies on the Spring framework</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This example listens for two unrelated events. Although there is no significance to these events for our example, they demonstrate different ways of consuming Spring application events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WebServerInitializedEvent</code> tells when the embedded web server has finished initializing.</p>
</li>
<li>
<p>The <code>ApplicationReadyEvent</code> gets called as late as possible, right before the application handles traffic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are just a few of the events that Spring and Spring Boot emit as part of the lifecycle of an application. There are other events for all sorts of stuff, including Spring Security authentication, Actuator, Spring lifecycle, and more.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_reusable_recipe_for_object_creation">A Reusable Recipe for Object Creation</h3>
<div class="paragraph">
<p>Sometimes objects require finessing and customization. Sometimes, creating an object becomes more complicated than just a simple constructor. Therefore, isolating this construction logic in a single place is helpful because it is reusable. There are at least two patterns that describe this sort of parameterized construction beside a constructor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the fluid builder pattern</p>
</li>
<li>
<p>the factory pattern</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;s nothing Spring can do to support the first pattern: that&#8217;s very much up to each implementor how their types reflect the object creation patterns particular to their API. However, the Spring Framework <code>FactoryBean&lt;T&gt;</code> supports the second pattern. When you register a class of type <code>FactoryBean&lt;T&gt;</code> in the Spring context, it is the <em>product</em> (an instance of type <code>T</code>) of that <code>FactoryBean&lt;T&gt;</code>, not the <code>FactoryBean&lt;T&gt;</code> itself, that is registered in the application context and made available for injection. In other words, you can&#8217;t inject a reference to <code>FactoryBean&lt;Foo&gt;</code>, only <code>Foo</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at its use in a trivial example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.factorybeans;

import org.springframework.beans.factory.FactoryBean;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
class FactoryBeansConfiguration {

	// <b class="conum">(1)</b>
	@Bean
	AnimalFactoryBean animalFactoryBean() {
		return new AnimalFactoryBean(true, false);
	}

	// <b class="conum">(2)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; factoryBeanListener(Animal animal) {
		return event -&gt; animal.speak();
	}

}

class AnimalFactoryBean implements FactoryBean&lt;Animal&gt; {

	private final boolean likesYarn, likesFrisbees;

	AnimalFactoryBean(boolean likesYarn, boolean likesFrisbees) {
		this.likesYarn = likesYarn;
		this.likesFrisbees = likesFrisbees;
	}

	@Override
	public Animal getObject() {
		return (this.likesYarn &amp;&amp; !this.likesFrisbees) ? new Cat() : new Dog();
	}

	@Override
	public Class&lt;?&gt; getObjectType() {
		return Animal.class;
	}

}

interface Animal {

	void speak();

}

class Dog implements Animal {

	@Override
	public void speak() {
		System.out.println("woof");
	}

}

class Cat implements Animal {

	@Override
	public void speak() {
		System.out.println("meow");
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the <code>AnimalFactoryBean</code> produces an object of type <code>Animal</code>. But which? It depends on the parameters fed into the <code>FactoryBean</code>.</p>
</li>
<li>
<p>the client code injects the <code>Animal</code>, ignorant of the construction logic.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_scopes">Scopes</h3>
<div class="paragraph">
<p>Beans in Spring have a lifecycle governing a given object&#8217;s lifetime. Unless you specify something precisely, the default scope is <code>singleton</code>. Here are some of the more commonly used scopes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>singleton</code> - Spring creates a bean when the application starts up and destroys it when it shuts down. A bean defined in this way is <em>global</em> - all clients of the bean will see the same state. So take care to handle concurrent access to this state in the same way you would any multithreaded access.</p>
</li>
<li>
<p><code>session</code> - a bean is created anew for each new HTTP Session. Each user with an HTTP session will have their instance of the bean. Changes won&#8217;t be visible to other clients.</p>
</li>
<li>
<p><code>web</code> - each new HTTP request gets a new bean instance.</p>
</li>
<li>
<p><code>thread</code> - beans are unique to each thread. Sort of like a <code>ThreadLocal</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This mechanism is pluggable, so implementors may also provide their scopes. Spring does this across the portfolio in projects like Spring Web Flow and Spring Batch. You&#8217;ll also see it in third-party projects like the Flowable workflow engine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">package com.example.aot.scopes;

import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.annotation.RequestScope;

import java.util.UUID;

@Configuration
class ScopesConfiguration {

}

// <b class="conum">(1)</b>
@Component
@RequestScope
class RequestContext {

	private final String uuid = UUID.randomUUID().toString(); // <b class="conum">(2)</b>

	public String getUuid() {
		return uuid;
	}

}

@RestController
class ContextHttpController {

	private final RequestContext context;

	// <b class="conum">(3)</b>
	ContextHttpController(RequestContext context) {
		this.context = context;
	}

	@GetMapping("/scopes/context")
	String uuid() {
		return this.context.getUuid();
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this bean is a <code>request</code> scoped, so it&#8217;ll be created anew for each incoming HTTP request.</p>
</li>
<li>
<p>this request-scoped bean should be different across different HTTP requests but the same for successive accesses during the same HTTP request.</p>
</li>
<li>
<p>Spring is giving us a proxy, which won&#8217;t result in an actual instance until the bean starts its lifecycle, bound to whatever externalities govern them.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Compile the application and visit  <code><a href="http://localhost:8080/scopes/context" class="bare">http://localhost:8080/scopes/context</a></code> in your browser a few times. You should see that the <code>UUID</code> differs in each HTTP request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_qualifiers">Qualifiers</h3>
<div class="paragraph">
<p>Qualifiers are conceptually very simple: given two types with the same interface, how does Spring choose which to inject in a given place? The answer is that we <em>qualify</em> the bean we&#8217;d like.</p>
</div>
<div class="paragraph">
<p>Suppose we&#8217;re trying to build two applications with competing mobile phone marketplace implementations, like the Apple AppStore and Android&#8217;s Play store.</p>
</div>
<div class="paragraph">
<p>We might model them with an interface, which we&#8217;re calling <code>MobileMarketplace</code>. In this example, we have two implementations of that interface, and we&#8217;ve used the <code>@Qualifier</code> annotation on both the bean itself and the place where the Spring injects it. As long as the <code>String</code> <code>value</code> in the annotation matches, Spring will inject the correct instance.  This mechanism goes even further:  you can put <code>@Qualifier</code> on your custom annotation and then use that annotation instead of <code>@Qualifier</code> directly on the various implementations. This practice helps you enforce a ubiquitous language, making your code&#8217;s domain more approachable.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.qualifiers;

import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.stereotype.Service;

import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.util.Map;

@Configuration
class QualifiersConfiguration {

	// <b class="conum">(1)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; android(@Android MobileMarketplace mobileMarketplace) {
		return event -&gt; System.out.println(mobileMarketplace.getClass().toString());
	}

	// <b class="conum">(2)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; ios(@Apple MobileMarketplace mobileMarketplace) {
		return event -&gt; System.out.println(mobileMarketplace.getClass().toString());
	}

	// <b class="conum">(3)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; mobileMarketplaceListener(
			Map&lt;String, MobileMarketplace&gt; mobileMarketplaces) {
		return event -&gt; mobileMarketplaces
				.forEach((key, bean) -&gt; System.out.println(key + '=' + bean.getClass().getName()));
	}

}

// <b class="conum">(4)</b>
@Retention(RetentionPolicy.RUNTIME)
@Qualifier("ios")
@interface Apple {

}

@Retention(RetentionPolicy.RUNTIME)
@Qualifier("android")
@interface Android {

}

interface MobileMarketplace {

}

// <b class="conum">(5)</b>
@Service
@Qualifier("ios")
class AppStore implements MobileMarketplace {

}

@Service
@Qualifier("android")
class PlayStore implements MobileMarketplace {

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this bean uses the <code>android</code> implementation</p>
</li>
<li>
<p>this bean uses the <code>apple</code> implementation</p>
</li>
<li>
<p>can&#8217;t decide? Just inject a <code>Map&lt;String,T&gt;</code>, where <code>T</code> is the type you&#8217;re looking for. Spring will provide a map of bean names to bean instances.</p>
</li>
<li>
<p>we create a meta-annotation.</p>
</li>
<li>
<p>we implement the interface</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I love that I can directly define a bean&#8217;s qualifier using the <code>@Qualifier</code> annotation and inject it into a particular site using the meta-annotation. Or vice versa, or both. Spring doesn&#8217;t care. <em>It just works</em>.</p>
</div>
<div class="paragraph">
<p>Compile and run the code to the correct instances printed out.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_properties">Configuration Properties</h3>
<div class="imageblock">
<div class="content">
<img src="images/environment.png" alt="environment">
</div>
</div>
<div class="paragraph">
<p>Spring Framework provides the <code>Environment</code> abstraction, mapping between a <code>String</code> key and a <code>String</code> value. In addition, there is a strategy interface (<code>PropertyResolver</code>) for resolving these properties. Spring Boot can then take values in the <code>Environment</code> and map them to objects via setters or their constructors. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.properties;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
@EnableConfigurationProperties(DemoProperties.class)
class PropertiesConfiguration {

	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; propertiesApplicationListener( // <b class="conum">(1)</b>
			DemoProperties properties) {
		return args -&gt; System.out.println("the name is " + properties.name());
	}

}

// <b class="conum">(2)</b>
@ConfigurationProperties(prefix = "bootiful")
record DemoProperties(String name) {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here, we&#8217;re injecting a Java object called <code>DemoProperties</code>, to which properties starting with <code>bootiful</code> are bound</p>
</li>
<li>
<p>the <code>@ConfigurationProperties</code> annotation wires Spring to inject properties onto an instance of <code>DemoProperties</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Compile and run the code to see the values reflected in the output.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_detecting_that_youre_in_a_native_image">Detecting that you&#8217;re in a Native Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes hopefully not often! - you&#8217;ll want to know when your code runs in a native image context. Knowing when your application is running is helpful because, as good as Spring&#8217;s AOT engine is, we can&#8217;t make it work perfectly in every situation, short of reviewing every line of code written. Some oddities arise from working in a GraalVM native image, and it&#8217;s essential to be aware of those.</p>
</div>
<div class="paragraph">
<p>There is one helpful System property that you can use here: <code>org.graalvm.native image.imagecode</code>.  We&#8217;ve encapsulated that check-in a method in Spring Framework: <code>NativeDetector.inNativeImage()</code>. So here it is in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.detection;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.NativeDetector;

@Configuration
class DetectionConfiguration {

	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; detectionListener() {
		return args -&gt; System.out.println("is native image? " + NativeDetector.inNativeImage());
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run it on the JRE, and it&#8217;ll return <code>false</code>. Run it in a GraalVM native image, and it&#8217;ll return <code>true</code>.</p>
</div>
<div class="paragraph">
<p>My first instinct when I learned about that property was to wrap it in a <code>Condition</code> object and then use <code>@Conditional</code> to call that <code>Condition</code>, and thus make beans available in the Spring <code>BeanFactory</code> <em>conditionally</em>.</p>
</div>
<div class="paragraph">
<p>I tried it, and it didn&#8217;t work.</p>
</div>
<div class="paragraph">
<p>Recall our discussion around the <em>phases</em> of a Spring Boot application. It starts up, <em>ingests</em> all the configuration, then creates a metamodel representation of the beans (<code>BeanDefinition</code> instances). Finally, Spring creates all the beans out of those <code>BeanDefinition</code> instances.</p>
</div>
<div class="paragraph">
<p>In an AOT application intended for GraalVM native image compilation, Spring Framework introduces a new phase during the compilation of the code. In this new phase, the Spring Boot build plugin creates a <code>BeanFactory</code> with populated <code>BeanDefinition</code> instances and stops there. Spring has a few new interfaces that are created and given a chance to inspect this <code>BeanFactory</code>, contributing whatever extra metadata is required to compile the beans in a GraalVM native image properly.</p>
</div>
<div class="paragraph">
<p>These interfaces also generate <em>new</em>, optimized code to recreate the state of the <code>BeanFactory</code> and skip the ingest phase. This new code and the contributed metadata are ultimately sent into the GraalVM native image compiler for compilation into a native image.</p>
</div>
<div class="paragraph">
<p>Spring only includes the beans in the final build present in the <code>BeanFactory</code> at compile time. So, if you have a bean that wasn&#8217;t created at compile time because some <code>@Conditional</code> test evaluated to <code>false</code>, or because some profile wasn&#8217;t active, it won&#8217;t be there in the native image. To that end, I&#8217;d strongly urge you to avoid using profiles if you intend to create a GraalVM native image. There are some <code>@Conditional</code> annotations you should avoid, too.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s AOT engine evaluates the <code>@Conditional</code> annotations at compile time. Some invariant conditions are the same at compilation time and runtime - like <code>@ConditionalOnClass</code> and <code>@ConditionalOnProperty</code>. They work just fine in the native world: the classes present at compile time are, by definition, the classes present at runtime. However, some conditions depend on ambient state, like whether you&#8217;re running in a Kubernetes cluster (<code>@ConditionalOnCloudPlatform(platform=CloudPlatform.Kubernetes)</code>). Avoid these conditions unless you plan on compiling your code in a Kubernetes cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_migration">Application Migration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, everything works well out of the box. Our goal is that the vast majority of Spring applications have a path to upgrade to Spring Boot 3 and then enjoy the benefits of native image compilation. But, sometimes, things don&#8217;t work as expected because some code has done something to run afoul of the cases, as mentioned earlier, where you&#8217;ll need to furnish configuration <code>.json</code> files.</p>
</div>
<div class="paragraph">
<p>The error messages are pretty helpful, but the cycle time of compiling and running the application, getting a compiler error, making a change, then repeating can be tedious, especially when 30 seconds or longer compile times and long reset cycles are involved!</p>
</div>
<div class="paragraph">
<p>Once you know what configuration your application will need, it&#8217;s pretty straightforward to craft the hints using the Java API. The trouble is, how do you figure out what hints are required? It can be tortuous to have an idea, make the change, then wait a minute (or more!) to find out if that worked and - if not - what the next error is. The reset cycle is what scares people. Mercifully, there are some pretty good ways to get a lot of this work done for you: running in AOT mode on the JRE and the GraalVM Java agent.</p>
</div>
<div class="sect2">
<h3 id="_run_the_aot_code_on_the_jre">Run the AOT Code on the JRE</h3>
<div class="paragraph">
<p>The first thing you might do is run the code in AOT mode. If you think about it,   Spring Boot applications now have three different runtime destinations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>traditional Spring Boot running on the JRE. This mode is the default and works exactly as it always has. Do nothing different, and you&#8217;ll get this mode.</p>
</li>
<li>
<p>code generated during the AOT phase of compilation, also run on the JRE</p>
</li>
<li>
<p>code generated during the AOT phase of compilation, running in a GraalVM native image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You get slightly more optimized performance when running AOT code on the JRE. Your application will perform considerably better when running the AOT code in a GraalVM native image.  That second option - running AOT code on the JRE - is also interesting because it lets you preview what will get fed into the GraalVM native image compiler, which is more performant than the traditional behavior.</p>
</div>
<div class="paragraph">
<p>You can generate the AOT code without doing a full GraalVM reset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean compile spring-boot:process-aot package</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command transforms your Spring application and generates GraalVM native image hints in the <code>target/spring-aot</code> directory of your application. You can inspect that directory to see which GraalVM native image hints were generated (under the <code>target</code> directory) and what code was generated (under the <code>sources</code> directory).</p>
</div>
<div class="paragraph">
<p>There&#8217;s a lot of interesting stuff happening here. The most important thing, from my perspective, is <code>AotApplication__BeanFactoryRegistrations.java</code>, in which all the  <code>@Configuration</code>-annotated classes from the codebase appear transpiled into functional bean registrations. These functional bean registrations skip all the ingest and yield a <code>BeanFactory</code> that looks like it would have had we run the normal code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
import org.springframework.boot.context.properties.ConfigurationPropertiesBindingPostProcessor__BeanDefinitions;
import org.springframework.boot.sql.init.dependency.DatabaseInitializationDependencyConfigurer__BeanDefinitions;
import org.springframework.boot.validation.beanvalidation.MethodValidationExcludeFilter__BeanDefinitions;
import org.springframework.boot.web.server.ErrorPageRegistrarBeanPostProcessor__BeanDefinitions;
import org.springframework.boot.web.server.WebServerFactoryCustomizerBeanPostProcessor__BeanDefinitions;
import org.springframework.context.event.DefaultEventListenerFactory__BeanDefinitions;
import org.springframework.context.event.EventListenerMethodProcessor__BeanDefinitions;
import org.springframework.data.repository.core.support.PropertiesBasedNamedQueries__BeanDefinitions;
import org.springframework.data.repository.core.support.RepositoryComposition__BeanDefinitions;
import org.springframework.data.web.config.ProjectingArgumentResolverRegistrar__BeanDefinitions;
import org.springframework.data.web.config.SpringDataJacksonConfiguration__BeanDefinitions;
import org.springframework.data.web.config.SpringDataWebConfiguration__BeanDefinitions;
import org.springframework.transaction.annotation.AbstractTransactionManagementConfiguration__BeanDefinitions;
import org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration__BeanDefinitions;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport__BeanDefinitions;

/**
 * Register bean definitions for the bean factory.
 */
public class AotApplication__BeanFactoryRegistrations {
  /**
   * Register the bean definitions.
   */
  public void registerBeanDefinitions(DefaultListableBeanFactory beanFactory) {
    beanFactory.registerBeanDefinition("org.springframework.context.event.internalEventListenerProcessor", EventListenerMethodProcessor__BeanDefinitions.getInternalEventListenerProcessorBeanDefinition());
    beanFactory.registerBeanDefinition("org.springframework.context.event.internalEventListenerFactory", DefaultEventListenerFactory__BeanDefinitions.getInternalEventListenerFactoryBeanDefinition());
    beanFactory.registerBeanDefinition("aotApplication", AotApplication__BeanDefinitions.getAotApplicationBeanDefinition());
    beanFactory.registerBeanDefinition("basicsConfiguration", BasicsConfiguration__BeanDefinitions.getBasicsConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("bfppConfiguration", BfppConfiguration__BeanDefinitions.getBfppConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("compilationEndpointConfiguration", CompilationEndpointConfiguration__BeanDefinitions.getCompilationEndpointConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("orderService", OrderService__BeanDefinitions.getOrderServiceBeanDefinition());
    beanFactory.registerBeanDefinition("proxiesConfiguration", ProxiesConfiguration__BeanDefinitions.getProxiesConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("componentsConfiguration", ComponentsConfiguration__BeanDefinitions.getComponentsConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("greetingsController", GreetingsController__BeanDefinitions.getGreetingsControllerBeanDefinition());
    beanFactory.registerBeanDefinition("detectionConfiguration", DetectionConfiguration__BeanDefinitions.getDetectionConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("eventsConfiguration", EventsConfiguration__BeanDefinitions.getEventsConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("factoryBeansConfiguration", FactoryBeansConfiguration__BeanDefinitions.getFactoryBeansConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("migrationsConfiguration", MigrationsConfiguration__BeanDefinitions.getMigrationsConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("propertiesConfiguration", PropertiesConfiguration__BeanDefinitions.getPropertiesConfigurationBeanDefinition());
    beanFactory.registerBeanDefinition("appStore", AppStore__BeanDefinitions.getAppStoreBeanDefinition());
    beanFactory.registerBeanDefinition("playStore", PlayStore__BeanDefinitions.getPlayStoreBeanDefinition());
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is more to discuss here, but that&#8217;ll have to wait.</p>
</div>
<div class="paragraph">
<p>You can run the AOT-optimized and generated code on the JRE using the  <code>-DspringAot=true</code> switch. Thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">java -DspringAot=true -jar aot-0.0.1-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure the Spring Boot build plugin to run with that switch active by default, too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;systemPropertyVariables&gt;
            &lt;springAot&gt;true&lt;/springAot&gt;
        &lt;/systemPropertyVariables&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run it in the usual way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AOT mode is great because it&#8217;s much faster than a complete GraalVM native image compilation and run. In addition, you&#8217;ll find that because the AOT mode generates more efficient code that cuts out a lot of the extra <code>BeanDefinition</code> instances that might otherwise hang around, the resulting application can be slightly more efficient even just running on the JRE.</p>
</div>
<div class="paragraph">
<p>That said, running in the AOT mode is only useful if you&#8217;re trying to sift through the generated files to confirm something is as it should be. It doesn&#8217;t help you if you don&#8217;t yet know what should be in the first place. This part can be tricky because it can be difficult to know what configuration is required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_java_agent">Run the Java Agent</h3>
<div class="paragraph">
<p>You can run the program and the agent alongside it and get the agent to tell you what things were reflected on, serialized, proxied, etc., by running the app on the JVM with <code>-Dagent=true</code> when running the app with maven (try <code>mvn spring-boot:run</code>). The agent dumps config files in the <code>target/native/agent-output</code> directory. You can inspect those and then use those to tell you what you&#8217;ll need to contribute hints for. The Java agent dumps out <em>everything</em>, including some things that Spring&#8217;s AOT engine will do automatically for you, and thus, you don&#8217;t need to reproduce. I&#8217;d start with all the mentions of types across the various configuration files in the same packages as the code in your application. That way, you won&#8217;t specify hints that Spring might&#8217;ve already done for you.</p>
</div>
<div class="paragraph">
<p>Importantly: the program also prints out all the random stuff and changes from one run to another. YOu can usually identify these as the classes with dollar signs in them or UUID-like names. Ignore those until the very end. They&#8217;re probably not interesting.</p>
</div>
<div class="paragraph">
<p>Configure the Spring Boot Maven build plugin to contribute a JVM argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;configuration&gt;
        &lt;jvmArguments&gt;
            -agentlib:native-image-agent=config-output-dir=target/native-image
        &lt;/jvmArguments&gt;
        &lt;!--....--&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run it thusly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./mvnw -DskipTests clean package spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inspect the <code>target/native-image/</code> directory. You&#8217;ll find that the Java agent has written out a <code>reflect-config.json</code> file that tells us something will reflect upon the <code>Person</code> type at runtime. We can also see an entry for the <code>data.csv</code> file in the <code>resource-config.json</code> file.</p>
</div>
<div class="paragraph">
<p>It would be best to exhaust as many code paths as possible while running the Java agent. Perhaps you could run it while running your tests?  We want to ensure that you capture every scenario that may require configuration. Be sure to go through all the <code>.json</code> configuration files and note every instance where one of the types we&#8217;ve created - like <code>Person</code> -  is present.</p>
</div>
<div class="paragraph">
<p>At this point, I&#8217;d disable the Java agent, commenting it out in the Maven <code>pom.xml</code>. It&#8217;s served its purpose for now. Move the <code>native-image</code> directory aside, so it doesn&#8217;t get deleted later. If you try to compile and run the application as a GraalVM native image and fail, you will want to consult these files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_soft_touch_refactorings_to_enable_aot">Soft-touch Refactorings to Enable AOT</h3>
<div class="paragraph">
<p>Let&#8217;s look at a bare-bones example that could run afoul of GraalVM&#8217;s native image compilation but for our interventions. Here&#8217;s the completed program, complete with code to support the Spring AOT engine&#8217;s work turning our application into a GraalVM native image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.migrations;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.SneakyThrows;
import org.springframework.aot.hint.RuntimeHints;
import org.springframework.aot.hint.RuntimeHintsRegistrar;
import org.springframework.aot.hint.annotation.RegisterReflectionForBinding;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.ImportRuntimeHints;
import org.springframework.core.io.Resource;
import org.springframework.util.FileCopyUtils;

import java.io.InputStreamReader;
import java.util.stream.Stream;

@Configuration
class MigrationsConfiguration {

	// <b class="conum">(1)</b>
	record Person(String id, String name) {
	}

	@Bean
	@RegisterReflectionForBinding(Person.class) // <b class="conum">(2)</b>
	@ImportRuntimeHints(MigrationsRuntimeHintsRegistrar.class)
	ApplicationListener&lt;ApplicationReadyEvent&gt; peopleListener(ObjectMapper objectMapper,
			@Value("classpath:/data.csv") Resource csv) { // <b class="conum">(3)</b>
		return new ApplicationListener&lt;ApplicationReadyEvent&gt;() {
			@SneakyThrows
			@Override
			public void onApplicationEvent(ApplicationReadyEvent event) {
				try (var in = new InputStreamReader(csv.getInputStream())) {
					var csvData = FileCopyUtils.copyToString(in);
					Stream.of(csvData.split(System.lineSeparator())).map(line -&gt; line.split(","))
							.map(row -&gt; new Person(row[0], row[1])).map(person -&gt; json(person, objectMapper))
							.forEach(System.out::println);
				}
			}
		};
	}

	@SneakyThrows
	private static String json(Person person, ObjectMapper objectMapper) {
		return objectMapper.writeValueAsString(person);
	}

	static class MigrationsRuntimeHintsRegistrar implements RuntimeHintsRegistrar {

		@Override
		public void registerHints(RuntimeHints hints, ClassLoader classLoader) {
			hints.resources().registerPattern("data.csv");

			// <b class="conum">(4)</b>
			// hints.reflection().registerType(Person.class, MemberCategory.values());
		}

	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this program simply reads in CSV data (in the least production-worthy  way possible!) and maps the rows into <code>Person</code> instances</p>
</li>
<li>
<p>we know that the Jackson JSON marshaling library will need to reflect on those <code>Person</code> instances, so we&#8217;ve used Spring&#8217;s convenient <code>@RegisterReflectionForBinding</code> annotation to tell Spring to proactively register the GraalVM hints required to support that. This annotation must be on or in a Spring component or <code>@Configuration</code> class.</p>
</li>
<li>
<p>we know that this program will need to read the <code>.csv</code> file from the <code>.jar</code>, a resource, which will be a problem for GraalVM unless we contribute some hints. We use the <code>@ImportRuntimeHints</code> annotation to tell Spring to involve a class of type <code>RuntimeHintsRegistrar</code> in the compilation process so that we can programmatically contribute those hints.</p>
</li>
<li>
<p>we <em>could</em>, as an alternative to using the <code>@RegisterReflectionForBinding</code> annotation, have also contributed a hint for reflective access for that type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You&#8217;ll need to create a file with sample data called <code>src/main/resources/data.csv</code>. Here&#8217;s the one I put in the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">1,Josh
2,Stphane
3,Andy
4,Madhura
5,Olga
6,Yuxin
7,Violetta
8,Spencer
9,Chloe
10,Dr. Syer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this on the JRE, and it should just work. As expected.</p>
</div>
<div class="paragraph">
<p>Now, for our example to work - or, instead, <em>not</em> work, in a GraalVM native image, you&#8217;ll need to comment out the lines where we use the <code>@RegisterReflectionForBinding</code> and <code>@ImportRuntimeHints</code> annotations. Then, run and compile the program. You should see failures when you start it up as a GraalVM native image.</p>
</div>
<div class="paragraph">
<p>The first error I got was related to being unable to load the <code>.csv</code> file. So, restore the <code>@ImportRuntimeHints</code> annotation. Compile and run that as a GraalVM native image. Next, you&#8217;ll get an error about serializing the <code>Person</code>. Restore the line with <code>@RegisterReflectionForBinding</code>, and everything should work.</p>
</div>
<div class="paragraph">
<p>Compile and run the program; you should see the <code>Person</code> records printed on the console.</p>
</div>
<div class="paragraph">
<p>This program uses the Jackson JSON marshaling library directly to print out JSON representations of some objects. This example is a bit contrived: when was the last time you used Jackson to print out some objects, and <em>that&#8217;s all</em>? It seldom happens.  If this program had a controller that returned the <code>Person</code>, Spring would automatically know to register hints for it. There are a lot of common cases like this where Spring will <em>just work</em>.</p>
</div>
<div class="paragraph">
<p>Spring will still need a custom hint for the <code>.csv</code> file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_processing_the_bean_factory">Processing the Bean Factory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring makes it trivial to act on a collection of  <code>BeanDefinition</code> instances through callback interfaces evaluated at compile time (AOT) and runtime (JRE). For example, the <code>BeanFactoryPostProcessor</code> is a callback interface that lets us access the <code>BeanFactory</code> and manipulate the <code>BeanDefinition</code> instances. We can register new ones, update existing ones, or even remove them in this interface and other, more specific subclasses of this interface.</p>
</div>
<div class="paragraph">
<p>The <code>BeanFactory</code> is mutable at this point. Various Spring projects use this fact to great effect. Before the Spring team turned the Spring Cloud project into the microservices sensation it is today; its sole function was to make it easy for Spring Boot applications deployed to a Platform-as-a-Service (PaaS) (like Cloud Foundry or Heroku) to connect to managed infrastructure like a database or a message queue. It did this by analyzing the <code>BeanFactory</code>, identifying infrastructure-related beans like <code>javax.sql.DataSource</code>, and then replacing them with a new bean of an identical interface, but with a connection that is pointing to the managed infrastructure identified by environment variables in the process space of the running application. So, you write an application using a <code>DataSource</code> talking to an embedded H2 instance on your local machine. Still, when you deploy it, this <code>BeanFactoryPostProcessor</code> identifies connection strings in environment variables in the process space for the application and uses that to create a proper <code>DataSource</code> pointing to managed infrastructure, presumably on another host and port. This process was transparent to the user, thanks to the magic of <code>BeanFactoryPostProcessor</code> implementations.</p>
</div>
<div class="paragraph">
<p>The <code>BeanFactoryPostProcessor</code> is a great place to see <em>everything</em> in the <code>BeanFactory</code> all in one place when the application starts up.</p>
</div>
<div class="paragraph">
<p>The <code>BeanFactoryInitializationAotProcessor</code> is a new interface that is a peer to the <code>BeanFactoryPostProcessor</code>. It runs at compile time, and you have the same contract: you can contribute hints (or even do code-generation) while analyzing the <code>BeanDefinition</code> instances in the application.</p>
</div>
<div class="paragraph">
<p>You must work only in terms of the <code>BeanDefinition</code> instances and bean names in both these interfaces. Remember, Spring hasn&#8217;t created any of the beans at this point. So, while you&#8217;ll be able to call <code>BeanFactory#getBean(String)</code>, it&#8217;ll force  Spring to eagerly initialize the object, calling the constructor and the methods and so on before the bean is ready. Don&#8217;t do this - it&#8217;ll screw things up!</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a trivial example. We&#8217;ll write a <code>BeanFactoryPostProcessor</code> that analyzes and programmatically registers a new <code>BeanDefinition</code> in the application context. Would you ever need to do this? No. But it&#8217;s hopefully illustrative. We&#8217;ll use a subclass of <code>BeanFactoryPostProcessor</code> called <code>BeanDefinitionRegistryPostProcessor</code>, which gives us a <code>BeanFactory</code> downcast to a specific subtype that supports programmatically registering new beans. The trouble is that this bean we&#8217;ll register will require some reflection using the Jackson JSON API, so we&#8217;ll need to also register a GraalVM hint for it using a <code>BeanFactoryInitializationAotProcessor</code> contribution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.bfpp;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.SneakyThrows;
import org.springframework.aot.hint.MemberCategory;
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.aot.BeanFactoryInitializationAotContribution;
import org.springframework.beans.factory.aot.BeanFactoryInitializationAotProcessor;
import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;
import org.springframework.beans.factory.support.BeanDefinitionBuilder;
import org.springframework.beans.factory.support.BeanDefinitionRegistry;
import org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;
import java.util.UUID;

import static com.example.aot.bfpp.BfppConfiguration.BEAN_NAME;

@Configuration
class BfppConfiguration {

	// <b class="conum">(1)</b>
	static String BEAN_NAME = "myBfppListener";

	// <b class="conum">(2)</b>
	@Bean
	static ListenerBeanFactoryPostProcessor listenerBeanFactoryPostProcessor() {
		return new ListenerBeanFactoryPostProcessor();
	}

	@Bean
	static ListenerBeanFactoryInitializationAotProcessor listenerBeanFactoryInitializationAotProcessor() {
		return new ListenerBeanFactoryInitializationAotProcessor();
	}

}

// <b class="conum">(3)</b>
class Listener implements ApplicationListener&lt;ApplicationReadyEvent&gt; {

	private final ObjectMapper objectMapper;

	Listener(ObjectMapper objectMapper) {
		this.objectMapper = objectMapper;
	}

	@Override
	@SneakyThrows
	public void onApplicationEvent(ApplicationReadyEvent event) {
		var products = List.of(new Product(UUID.randomUUID().toString()), new Product(UUID.randomUUID().toString()));
		for (var p : products)
			System.out.println(objectMapper.writeValueAsString(p));
	}

}

record Product(String sku) {
}

// <b class="conum">(4)</b>
class ListenerBeanFactoryPostProcessor implements BeanDefinitionRegistryPostProcessor {

	@Override
	public void postProcessBeanFactory(ConfigurableListableBeanFactory bf) throws BeansException {
	}

	@Override
	public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException {
		if (!registry.containsBeanDefinition(BEAN_NAME))
			registry.registerBeanDefinition(BEAN_NAME,
					BeanDefinitionBuilder.rootBeanDefinition("com.example.aot.bfpp.Listener").getBeanDefinition());
	}

}

// <b class="conum">(5)</b>
class ListenerBeanFactoryInitializationAotProcessor implements BeanFactoryInitializationAotProcessor {

	@Override
	public BeanFactoryInitializationAotContribution processAheadOfTime(ConfigurableListableBeanFactory bf) {

		if (bf.containsBeanDefinition(BEAN_NAME)) {
			return (ctx, code) -&gt; {
				var hints = ctx.getRuntimeHints();
				hints.reflection().registerType(Product.class, MemberCategory.values());
			};
		}
		return null;
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>we were going to work with the same bean at compile time and runtime. Here, we create a variable with the name of the bean for subsequent access from both interface implementations at both phases (AOT and runtime)</p>
</li>
<li>
<p>Note that we use the <code>static</code> keyword with both bean definition registrations. Spring will involve these beans very early in the lifecycle of the <code>BeanFactory</code>. There will not be any live-fire beans. So,  use <code>static</code> to avoid weird lifecycle issues. Avoid depending on anything from the <code>BeanFactory</code>. Don&#8217;t force Spring to construct the <code>@Configuration</code> class containing the <code>@Bean</code> registration methods, too.</p>
</li>
<li>
<p>the <code>Listener</code> class is a trivia <code>ApplicationListener</code> that, when run, will iterate over a collection of dummy DTOs and print them out using Jackson for JSON serialization. This serialization involves reflection, for which we&#8217;ll need to furnish hints.</p>
</li>
<li>
<p>the first callback, the <code>ListenerBeanFactoryPostProcessor</code>, programmatically registers a new <code>BeanDefinition</code> of type <code>Listener</code> if a bean of the name we&#8217;ve specified in the variable doesn&#8217;t already exist in the context. This object runs at runtime in both the JRE and the AOT application. Here we mutate the <code>BeanFactory</code>.</p>
</li>
<li>
<p>Spring&#8217;s AOT engine will involve the <code>ListenerBeanFactoryInitializationAotProcessor</code> during the compilation phase so that it may furnish hints to make the JSON serialization of the <code>Product</code> records work.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These two interfaces work well together. They complement each other. The <code>BeanFactory</code> is the lowest level against which I&#8217;d write code when manipulating the Spring application context. I don&#8217;t want to write code in terms of the <code>BeanFactory</code> if I can avoid it. The <code>BeanFactory</code> suggests a  valid working application. But it&#8217;s not a working application. Spring must first turn the <code>BeanDefinition</code> instances into valid objects, or <em>beans</em>. That part comes next.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_processing_beans">Processing Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose the <code>BeanFactory</code> is too meta (no, not <em>that</em> Meta!) for you. In that case, you can still do interesting things at the next rung in the abstraction ladder, working with beans directly, both before initialization and after.</p>
</div>
<div class="paragraph">
<p>Working on a bean-by-bean basis can be very powerful. If you want to work with actual, live-fire beans, you can use Spring&#8217;s <code>BeanPostProcessor</code>. This interface puts you in a position to act on and transform objects before they&#8217;re finally live and handling logic. <code>BeanPostProcessor</code> instances are great for infrastructure code, such as frameworks, where you need to note, retain, or observe references to objects of a given shape. What shape? Well, anything! Objects that have a certain marker interface. Objects that have a certain annotation. Whatever you want and whatever you could discover, given reflection.  Let&#8217;s look at an example that creates proxies for beans with an annotation, <code>@Logged</code>, logging out any method invocations.</p>
</div>
<div class="paragraph">
<p>I implement this proxy with Spring&#8217;s <code>ProxyFactory</code>, which makes it trivial to use the <em>proxy</em> design pattern. In its most general form, a proxy is a class functioning as an interface to something else. Spring uses proxies to handle declarative transaction management, auditing, security, logging, concurrency, etc. there is a great way to <em>decorate</em> an existing object with cross-cutting concerns, like starting and committing a transaction before and after a method invocation. Spring uses them all over the place for things like <code>@Transactional</code>, <code>@Scheduled</code>, <code>@Async</code>, <code>@Authorized</code>, and countless more.</p>
</div>
<div class="paragraph">
<p>There are two types of proxies: CGLIB and JDK. Proxies make it trivial to create an object that implements an interface type of your choice and then forwards the actual work to a concrete instance of your choice.  JDK proxies are built with Java&#8217;s <a href="https://www.baeldung.com/java-dynamic-proxies"><code>InvocationHandler</code></a>.  In the case of JDK proxies, the word <code>interface</code>  used in the description above is quite literally a Java <code>interface</code> type.</p>
</div>
<div class="paragraph">
<p>But what if the contract of the surface area, the <em>interface</em> of your class, isn&#8217;t a Java interface? What if it&#8217;s a concrete class for which it makes little sense to extract a separate Java interface? JDK proxies require an interface, and they were the only thing supported in Spring until Spring Framework 1.1.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
I can&#8217;t be sure, but I suspect this is one of the reasons so much of the early literature for Spring Framework suggests using interfaces with Spring beans and why you&#8217;d see things like <code>FooService</code> and <code>DefaultFooService</code> or <code>FooService</code> and <code>FooServiceImpl</code> or whatever. Nowadays, that&#8217;s an anti-pattern and highly discouraged, <em>unless</em> you plan to have more than one implementation of <code>FooService</code>. Avoid the knee-jerk reaction to create an interface for an object that has the same shape as the object. It only complicates things.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring supports concrete proxies, too, using <a href="https://github.com/cglib/cglib">CGLIB</a>. CGLIB is used to dynamically generate the code to subclass an existing type. The constraint, thus, is that the type is subclassable. So, beware of things like <code>final</code> and <code>sealed</code>.</p>
</div>
<div class="paragraph">
<p>Spring&#8217;s concrete proxies are unique to Spring, but they&#8217;re <em>everywhere</em>. You use them every time you use a <code>@Configuration</code> class!</p>
</div>
<div class="paragraph">
<p>Naturally, creating a dynamic subclass of a given type, registering it in the <code>ClassLoader</code>, and then swapping out your instance for the instance that delegates to yours imply a lot of funny business that we&#8217;ll need to account for everything at compile time in a GraalVM native image context.</p>
</div>
<div class="sect2">
<h3 id="_proxies">Proxies</h3>
<div class="paragraph">
<p>Mercifully, Spring can do a lot of this for us. Let&#8217;s take a look at an example.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple proxy example of the logs information whenever somebody invokes a method annotated called <code>@Logged</code>, which we&#8217;ll create. The annotation is nice because it&#8217;s decorative. We&#8217;re layering capabilities onto this method without complicating the business logic implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.bpp.proxies;

import org.aopalliance.intercept.MethodInterceptor;
import org.springframework.aop.framework.ProxyFactory;
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.stereotype.Service;
import org.springframework.util.ReflectionUtils;

import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

@Configuration
class ProxiesConfiguration {

	// <b class="conum">(1)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; loggedListener(OrderService service) {
		return event -&gt; service.addToPrices(7);
	}

	@Bean
	LoggedBeanPostProcessor loggedBeanPostProcessor() {
		return new LoggedBeanPostProcessor();
	}

}

// <b class="conum">(2)</b>
class LoggedBeanPostProcessor implements SmartInstantiationAwareBeanPostProcessor {

	// <b class="conum">(3)</b>
	private static ProxyFactory proxyFactory(Object target, Class&lt;?&gt; targetClass) {
		var pf = new ProxyFactory();
		pf.setTargetClass(targetClass);
		pf.setInterfaces(targetClass.getInterfaces());
		pf.setProxyTargetClass(true); // <b class="conum">(4)</b>
		pf.addAdvice((MethodInterceptor) invocation -&gt; {
			var methodName = invocation.getMethod().getName();
			System.out.println("before " + methodName);
			var result = invocation.getMethod().invoke(target, invocation.getArguments());
			System.out.println("after " + methodName);
			return result;
		});
		if (null != target) {
			pf.setTarget(target);
		}
		return pf;
	}

	// <b class="conum">(5)</b>
	private static boolean matches(Class&lt;?&gt; clazzName) {
		return clazzName != null &amp;&amp; (clazzName.getAnnotation(Logged.class) != null || ReflectionUtils
				.getUniqueDeclaredMethods(clazzName, method -&gt; method.getAnnotation(Logged.class) != null).length &gt; 0);
	}

	// <b class="conum">(6)</b>
	@Override
	public Class&lt;?&gt; determineBeanType(Class&lt;?&gt; beanClass, String beanName) throws BeansException {
		if (matches(beanClass)) {
			return proxyFactory(null, beanClass).getProxyClass(beanClass.getClassLoader());
		}
		return beanClass;
	}

	// <b class="conum">(7)</b>
	@Override
	public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
		var beanClass = bean.getClass();
		if (matches(beanClass)) {
			return proxyFactory(bean, beanClass).getProxy(beanClass.getClassLoader());
		}
		return bean;
	}

}

@Inherited
@Target({ TYPE, METHOD })
@Retention(RUNTIME)
@interface Logged {

}

@Logged
@Service
class OrderService {

	public void addToPrices(double amount) {
		System.out.println("adding $" + amount);
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>as usual, we&#8217;ll try things out when the application starts up</p>
</li>
<li>
<p>we&#8217;re going to create this proxy in a subclass of <code>BeanPostProcessor</code> called <code>SmartInstantiationAwareBeanPostProcessor</code>. Spring&#8217;s AOT engine invokes the <code>SmartInstantiationAwareBeanPostProcessor#determineBeanType</code> to determine what the bean should be. Spring&#8217;s AOT engine uses that information to determine what proxies to build. When the application starts up completely, Spring will also invoke <code>SmartInstantiationAwareBeanPostProcessor#postProcessAfterInitialization(Object bean, String beanName)</code>, giving you a chance to inspect a given bean and -</p>
</li>
<li>
<p>we need to both build a proxy and determine the resulting class of that proxy at various phases in the lifecycle of the <code>SmartInstantiationAwareBeanPostProcessor</code>. So, we&#8217;ll return the builder, an instance of <code>ProxyFactory</code>, and we&#8217;ll either use it to determine the expected proxy&#8217;s class type or create the final proxy object.</p>
</li>
<li>
<p>setting <code>proxyTargetClass</code> to <code>true</code> and specifying a <code>targetClass</code> results in a CGLIB proxy. Otherwise, the expectation is that you&#8217;re only proxying interfaces.</p>
</li>
<li>
<p><code>BeanPostProcessor</code> implementations visit every bean in the <code>BeanFactory</code>, so we must only act on those with the annotation present. The <code>matches</code> method encodes this logic that looks for all types annotated with, or with methods annotated with, the <code>@Logged</code> annotation.</p>
</li>
<li>
<p>the <code>SmartInstantiationAwareBeanPostProcessor#determineBeanType</code> method does almost all the work of creating a proxy but stops short of actually creating the proxy. We&#8217;re only interested in knowing what the class would be <em>if</em> we did create a proxy. This information then gets fed into the AOT engine.</p>
</li>
<li>
<p>here&#8217;s where the rubber meets the road, and Spring creates a CGLIB proxy at runtime. The proxy creation works fine, as Spring will have already registered the requisite hints with GraalVM during compilation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this example, we&#8217;re using the cohesive design of Spring&#8217;s AOT engine to transparently create proxies that <em>just work</em>. If we on the Spring team have done our job right, and you&#8217;ve written your code to leverage the right interfaces, then you can trust Spring to do the right thing for CGLIB proxies.</p>
</div>
<div class="paragraph">
<p>Compile and run the application, and you should see information logged when we invoke the method in the <code>ApplicationListener</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_code_generation">Code Generation</h3>
<div class="paragraph">
<p>Suppose you&#8217;re using a library, and it is using <code>InvocationHandler</code>, outside of Spring&#8217;s purview. You&#8217;ll need to furnish the appropriate hints for GraalVM knows what to do there. You might also have stuff you want to do at runtime that requires upfront, compile-time processing. Code generation is one of the most powerful dimensions of Spring&#8217;s AOT engine. We use it all over the place in Spring Framework 6!  You can both furnish configuration and generate code at compile with implementations of the AOT equivalent to <code>BeanPostProcessor</code>, the  <code>BeanRegistrationAotProcessor</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a simple example. This time we&#8217;ll revisit the code generation but go even further. We&#8217;re going to register a brand new bean during compilation, overwriting one that&#8217;s already present, so that we can capture compile-time information and put it in the endpoint. This Actuator endpoint, the <code>CompilationEndpoint</code> is suitably trivial as to be understandable in a quick introduction like this one. This new <code>CompilationEndpoint</code> will capture information about the ambient state of the build <em>at compile-time</em>, like the time and directory in which the code is compiled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.bpp.code;

import org.springframework.beans.factory.aot.BeanRegistrationAotContribution;
import org.springframework.beans.factory.aot.BeanRegistrationAotProcessor;
import org.springframework.beans.factory.support.RegisteredBean;
import org.springframework.boot.actuate.endpoint.annotation.Endpoint;
import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.javapoet.CodeBlock;

import javax.lang.model.element.Modifier;
import java.io.File;
import java.time.Instant;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@Configuration
class CompilationEndpointConfiguration {

	// <b class="conum">(1)</b>
	@Bean
	CompilationEndpoint compilationEndpoint() {
		return new CompilationEndpoint();
	}

	// <b class="conum">(2)</b>
	@Bean
	CompilationEndpointBeanRegistrationAotProcessor compilationEndpointBeanRegistrationAotProcessor() {
		return new CompilationEndpointBeanRegistrationAotProcessor();
	}

	// <b class="conum">(3)</b>
	@Bean
	ApplicationListener&lt;ApplicationReadyEvent&gt; compilationEndpointListener(CompilationEndpoint endpoint) {
		return event -&gt; {
			var map = endpoint.compilation();
			for (var e : map.entrySet()) {
				System.out.println(e.getKey() + '=' + e.getValue());
			}
		};
	}

}

// <b class="conum">(4)</b>
@Endpoint(id = "compilation")
class CompilationEndpoint {

	private final Map&lt;String, Object&gt; map = new ConcurrentHashMap&lt;&gt;();

	CompilationEndpoint() { // default runtime version
	}

	CompilationEndpoint(Instant instant, File directory) {
		map.putAll(Map.of("instant", instant, "directory", directory));
	}

	@ReadOperation
	public Map&lt;String, Object&gt; compilation() {
		return Map.of("compilation", this.map, "now", Instant.now());
	}

}

// <b class="conum">(5)</b>
class CompilationEndpointBeanRegistrationAotProcessor implements BeanRegistrationAotProcessor {

	@Override
	public BeanRegistrationAotContribution processAheadOfTime(RegisteredBean registeredBean) {

		if (!CompilationEndpoint.class.isAssignableFrom(registeredBean.getBeanClass()))
			return null;

		return (ctx, code) -&gt; {

			var generatedClasses = ctx.getGeneratedClasses();

			var generatedClass = generatedClasses.getOrAddForFeatureComponent(
					CompilationEndpoint.class.getSimpleName() + "Feature", CompilationEndpoint.class,
					b -&gt; b.addModifiers(Modifier.PUBLIC));

			var generatedMethod = generatedClass.getMethods().add("postProcessCompilationEndpoint", build -&gt; {

				var outputBeanVariableName = "outputBean";
				build.addModifiers(Modifier.PUBLIC, Modifier.STATIC)
						.addParameter(RegisteredBean.class, "registeredBean") //
						.addParameter(CompilationEndpoint.class, "inputBean")//
						.returns(CompilationEndpoint.class)
						// <b class="conum">(6)</b>
						.addCode(CodeBlock.builder()
								.addStatement("$T $L = new $T( $T.ofEpochMilli($L), new $T($S))",
										CompilationEndpoint.class, outputBeanVariableName, CompilationEndpoint.class,
										Instant.class, System.currentTimeMillis() + "L", File.class,
										new File(".").getAbsolutePath()

								).addStatement("return $L", outputBeanVariableName).build());
			});
			var methodReference = generatedMethod.toMethodReference();
			code.addInstancePostProcessor(methodReference);
		};
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>we&#8217;re going to register an empty, no-op version of the <code>CompilationEndpoint</code> here</p>
</li>
<li>
<p>we will post-process the bean at compile time using an implementation of a <code>BeanRegistrationAotProcessor</code></p>
</li>
<li>
<p>as usual, we&#8217;ll test things out when the application starts.</p>
</li>
<li>
<p>Have you ever seen how to register a Spring Boot Actuator endpoint? Well, now you have. It&#8217;s easy. Actuator Endpoints should be agnostic of whichever rendering mechanism - HTTP, JMX, etc. - you might use. This endpoint exports key-value pairs in a <code>Map&lt;String, Object&gt;</code> returned from the <code>compilation()</code> read operation. Note that we have <em>two</em> constructors: one for the no-op case and another for information about the build, like the time and directory of the compilation.</p>
</li>
<li>
<p>Like the <code>BeanPostProcessor</code>, <code>BeanRegistrationAotProcessor</code> implementations work on a bean-by-bean basis, getting a chance to inspect and change them. We again use the Java Poet abstraction to register new code, a method named <code>postProcessCompilationEndpoint</code>, which takes an instance of type <code>RegisteredBean</code> and another instance of type <code>CompilationEndpoint</code>. The <code>RegisteredBean</code> allows us to inspect the reflective metadata associated with the bean, and of course, the <code>CompilationEndpoint</code> is the bean we created earlier. If the user doesn&#8217;t use Spring&#8217;s AOT engine, then the bean we looked at earlier is the only bean they&#8217;ll ever get. However, if they use the AOT engine, this method will return a <em>new</em> <code>CompilationEndpoint</code>, initialized with values during compilation.</p>
</li>
<li>
<p>the key bit starts here: we use Java Poet to create a new instance of <code>CompilationEndpoint</code> with real values initialized and captured during the AOT phase itself. Now <em>that&#8217;s</em> meta!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Compile the application and then wait a minute. Then run the application. You should see that the information about the compilation, which will have occurred a minute or earlier, will be printed in the console.</p>
</div>
<div class="paragraph">
<p>You can see the output of what we&#8217;ve just done in the resulting generated Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.bpp.code;

import java.io.File;
import java.time.Instant;
import org.springframework.beans.factory.support.RegisteredBean;

public class CompilationEndpoint__CompilationEndpointFeature {
  public static CompilationEndpoint postProcessCompilationEndpoint(RegisteredBean registeredBean,
      CompilationEndpoint inputBean) {
    CompilationEndpoint outputBean = new CompilationEndpoint( Instant.ofEpochMilli(1671163253822L), new File("/Users/jlong/Desktop/aot-ebook/spring-boot-3-aot/."));
    return outputBean;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pretty tricky, eh? We&#8217;ve written code to write out more code and transform objects whose definitions we ultimately end into the GraalVM native image compiler.  It is kind of mind-bending if you ask me.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indeed, <em>all</em> of this GraalVM AOT native image machinery is kind of mind-bending to me, if I&#8217;m honest! But, in all that we&#8217;ve seen, I hope you feel that you know what to look at to identify and work around issues you discover. Of course, fixing an issue is critical to success with technology. But how do you ensure that it <em>stays</em> fixed going forward? Here is where Spring&#8217;s rich testing support comes in. It, too, has been updated to work in a GraalVM native image context!</p>
</div>
<div class="paragraph">
<p>Testing is an incredibly important part of the story. The good news is we&#8217;ve done a ton of work to make testing <strong>just work</strong> in a native image context.</p>
</div>
<div class="paragraph">
<p>You can run   Maven, or Gradle builds in native mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn -PnativeTest test</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll get two output artifacts: one for tests and another for the production code. Fair warning tho! Producing the test code as a native image doubles the interminable compile time! That could be a few minutes. When the compilation finishes, there&#8217;ll be a binary in the <code>target</code> directory called <code>native-tests</code>. Run that to execute the test code as a native image.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.basics;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

// <b class="conum">(1)</b>
@SpringBootTest(properties = "spring.main.web-application-type=none")
class CustomerRepositoryTest {

	private final CustomerRepository repository;

	CustomerRepositoryTest(@Autowired CustomerRepository repository) {
		this.repository = repository;
	}

	@Test
	void persist() {
		var saved = repository.save(new Customer(null, "Name"));
		Assertions.assertNotNull(saved.id());
		Assertions.assertNotNull(saved);
	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>we are creating a Spring <code>ApplicationContext</code> and then using it to inject references to beans, like the <code>CustomerRepository</code> we created when we looked at AOT fundamentals earlier.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The basics work here. There are some exceptions; you may encounter issues with Mockito. But the basics work. Try it out!</p>
</div>
<div class="paragraph">
<p>It&#8217;s good that the basics work, too. So does it mean that we can run the usual test harness against our business logic and confirm to whatever extent we&#8217;d like that things work as they did before. but what about the new code designed to support turning your application into a GraalVM native image? What about the hints you register for a given type using the Spring AOT engine? Spring has you covered. You can use the new <code>RuntimeHintsPredicates</code> type to confirm that your hints are working as expected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.aot.migrations;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.aot.hint.RuntimeHints;
import org.springframework.aot.hint.predicate.RuntimeHintsPredicates;

class MigrationsConfigurationTest {

	@Test
	void hints() {
		var hints = new RuntimeHints();
		// <b class="conum">(1)</b>
		var registrar = new MigrationsConfiguration.MigrationsRuntimeHintsRegistrar();
		var classloader = getClass().getClassLoader();
		// <b class="conum">(2)</b>
		registrar.registerHints(hints, classloader);
		// <b class="conum">(3)</b>
		Assertions.assertThat(RuntimeHintsPredicates.resource().forResource("data.csv")).accepts(hints);

	}

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create an instance of our implementation on the <code>RuntimeHintsRegistrar</code> interface</p>
</li>
<li>
<p>call <code>RuntimeHintsRegistrar#registerHints</code> on our implementation, passing in mock instances of <code>RuntimeHints</code> and the current <code>ClassLoader</code></p>
</li>
<li>
<p>use the <code>RuntimeHintsPredicates</code> type to make certain assertions about the state of the <code>RuntimeHints</code> afterward</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The testing support in Spring is exhaustive, and the Spring Boot even more so. It is not surprising, thus, that Spring&#8217;s new AOT engine would further move the needle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_note_on_compile_times">A Note on Compile Times</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You know, I love GraalVM, but one thing that can be a real kick in the pants is the wait times. I get <em>why</em> it&#8217;s happening. It&#8217;s not hard to understand. GraalVM does a <em>lot</em> of work - doing a full analysis of our code and all the code on the classpath. So it&#8217;s no wonder it takes as much memory and time as it does. And it has already improved <em>dramatically</em> even since I first started using it in earnest less than three years ago. It&#8217;s a marvelous piece of software. But those compile times are tedious. They interrupt my sense of flow. These prolonged builds remind me of the famous <a href="https://xkcd.com/303/">XKCD "compiling" cartoon</a>.</p>
</div>
<div class="paragraph">
<p>And it&#8217;s almost a curse that they&#8217;ve improved as much as they have because the compilation times are now fast enough that you don&#8217;t have time to go pour a cup of coffee or eat a cup of yogurt but slow enough that you feel like you&#8217;re being interrupted. You&#8217;re being kicked out of 'the zone. This reminds me of that classic XKCD cartoon, which I suspect referred to large C and C++ applications of the day. Java, Go, and other more modern languages have quick compilation times. In this one sense, it feels like GraalVM has taken us a step backward. I kick off a compilation, and my mind wanders. I&#8217;ve been doing so many of these that I&#8217;m starting to hear elevator music when I  compile! Don&#8217;t you hear elevator music? <a href="https://github.com/oracle/graal/issues/5327">So I filed an issue</a>. I want everyone <em>else</em> to hear elevator music, too. So I asked. It doesn&#8217;t hurt to ask. I went to the official GraalVM project, and I asked. it seemed to <a href="https://github.com/oracle/graal/issues/5327#issue-1429805241">resonate with people</a>. One person even suggested as to <a href="https://github.com/oracle/graal/issues/5327#issuecomment-1297108398">which elevator music</a> should be played (one of the soundtracks from the Bond film <a href="https://static1.thegamerimages.com/wordpress/wp-content/uploads/2019/10/Goldeneye.v1.jpg"><em>Goldeneye</em></a>, natch). I love it! And, <a href="https://github.com/fniephaus">Fabio Niephaus</a> - of the official GraalVM team members at Oracle, a Ph.D. - a DOCTOR, like Drs. Seus, Syer, Strange, Who, and Subramaniam - responded with <em>a promising prototype</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/joshlong-mode.png" alt="joshlong mode">
</div>
</div>
<div class="paragraph">
<p>To say that I love this prototype would be an understatement!  I was sad to see that he didn&#8217;t think it would be merged, if for no other reason than because of the copyrighted music. Dang! Oh well. Hope <em>springs</em> eternal.</p>
</div>
<div class="paragraph">
<p>But, something good <em>did</em> come of this: there are some interesting ideas <a href="https://github.com/oracle/graal/issues/5327#issuecomment-1308971081">discussed</a> around how to have a bell chime (or indeed any other sound played) when the compilation finishes. At least this way, you&#8217;d never feel like you wasted precious time if you stepped away for a minute!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve come a long way! When I started covering Spring Native (the predecessor to what would eventually become Spring Framework 6&#8217;s AOT engine) in 2020, a build took <em>10 minutes</em> and only worked for the smallest and most specific scenarios. Now, here we are in 2022, and I can all but effortlessly get a Spring app working in a GraalVM native image context in less than a minute.</p>
</div>
<div class="paragraph">
<p>The performance and memory usage implications are hard to ignore. As the community embraces Spring&#8217;s newfound AOT support, I think the inertia required to move to AOT will become easier and easier to obtain in the next days, weeks, months, and years. I hope this video makes it easier for application and framework developers to leverage Spring Boot 3 and Spring Framework 6. You won&#8217;t be starved for examples if you need guidance in implementing this in your code. Look for pointers to types like <code>RuntimeHintsRegistrar</code>, <code>BeanRegistrationAotProcessor</code>, and <code>BeanFactoryInitializationAotProcessor</code> in the Spring Boot codebase! And those don&#8217;t even begin to cover the projects' implementations, like Spring Security, Spring Data, Spring Cloud, Spring Shell, Spring Integration, and Spring Batch. We&#8217;ve only just begun to scratch the surface here, my friends. And so, too, has the community. That said, things are moving <em>quickly</em>: As I write this, there&#8217;s already work nearly- or already- completed for various opensource projects like Axon, Vaadin, Hilla Framework, MyBatis, JHipster, the official Kubernetes Java client, JobRunr, so many others besides.</p>
</div>
<div class="paragraph">
<p>GraalVM native image technology could be a <em>very</em> powerful way to build applications better suited for production. GraalVM native images save costs and help you build more reliable systems. In addition, Spring&#8217;s AOT engine helps you introduce new possibilities, like serverless, embedded, and infrastructure, for which Spring may not have been considered ideal in the past.</p>
</div>
<div class="paragraph">
<p>I hope this humble text has helped you get started and that you can go to the <a href="https://start.spring.io">Spring Initialzr</a> and generate your next value-producing, production-bound Spring Boot application with GraalVM native image support!</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-12-15 20:00:39 -0800
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>